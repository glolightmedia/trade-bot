import pandas as pd
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score
import joblib
import os

# Generating synthetic data for demonstration
data = pd.DataFrame({
    "SMA_20": [1.1, 1.2, 1.0, 0.9, 1.3, 1.4, 1.5, 1.3, 1.2, 1.1],
    "RSI": [30, 40, 20, 10, 50, 60, 70, 55, 45, 35],
    "Volume": [1000, 1200, 1100, 900, 1500, 1400, 1600, 1300, 1200, 1100],
    "Price_Change": [0.05, 0.02, -0.03, -0.05, 0.07, 0.04, 0.06, 0.03, 0.01, -0.01],
    "Target": [1, 1, 0, 0, 1, 1, 1, 1, 0, 0]  # 1 = Buy, 0 = Hold/Sell
})

# Features and target
X = data[["SMA_20", "RSI", "Volume", "Price_Change"]]
y = data["Target"]

# Splitting the data
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Training the Random Forest model
rf_model = RandomForestClassifier(n_estimators=100, random_state=42)
rf_model.fit(X_train, y_train)

# Testing the model
y_pred = rf_model.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)
print(f"Model Accuracy: {accuracy:.2f}")

# Saving the trained model
file_path = "models/pre_trained/random_forest.pkl"
os.makedirs(os.path.dirname(file_path), exist_ok=True)  # Ensure directory exists
joblib.dump(rf_model, file_path)
print(f"Random Forest model saved to {file_path}")
